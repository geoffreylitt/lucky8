!!!
%html
  %head
    %meta{:name => "viewport", :content => "width=device-width, initial-scale=1.0"}
    %title= content_for?(:title) ? yield(:title) : 'Lucky8'
    %meta{:name => "description", :content => "#{content_for?(:description) ? yield(:description) : 'Lucky8'}"}
    = stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track' => true
    = javascript_include_tag "//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry"
    = javascript_include_tag "//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js"
    = javascript_include_tag 'application', 'data-turbolinks-track' => true

    = csrf_meta_tags
  %body{ data: { controller: controller.controller_name, action: controller.action_name }}
    %main{:role => "main"}
      .container
        = render 'layouts/messages'
        = yield
  :javascript
    $(document).on("page:change", function() {
      dataAction = $("body").attr("data-action");
      if(dataAction == "map" || dataAction == "show") {
        var mapOptions = { maxZoom: 16 }
        var handler = Gmaps.build('Google');
          handler.buildMap({ provider: mapOptions, internal: {id: 'map'}}, function(){
            markers = handler.addMarkers(#{@geocoded_hash.to_json});
            handler.bounds.extendWith(markers);
            handler.fitMapToBounds();
            handler.getMap().setZoom(12);
          });
      }

      $("#list-show-link").click(function(){
        location.href = "#{list_schools_url}";
      });

      $("#map-show-link").click(function(){
        location.href = "#{map_schools_url}";
      });
    });
